<?php

class GestionController extends Zend_Controller_Action
{

	/*
	*Formularios
	*/
	public function getFormCrear()
	{
		$form = new Application_Form_Crearprodlav;
		return $form;
	}
	public function getFormId()
	{
		$form = new Application_Form_Id;
		return $form;
	}
    public function init()
    {
        /* Initialize action controller here */
    }

   	/*
	*Titulo de la pag y mensajes
	*/
	public function contenidoPagina($titulo)
	{
		$this->view->mensaje = "\"\"";
		$this->view->titulo = $titulo;
	}

    public function indexAction()
	{
			$this->contenidoPagina("Crear Producto Lavanderia");
			//***ejecuto la consulta
	   		$serlav = new Application_Model_productostintoreria;
				$r = $serlav->Ejecuter(0);
				for($i=0; $i< sizeof($r); $i++){
					$r[$i][4] = "<a class='eliminar'  onclick=\"return confirm('Â¿Esta segur@ de eliminar el producto?')\" href=eliminar?id=".$r[$i][0].">Eliminar<a>";
				}
		
			//***devuelvo el json de la consulta
	    		$this->view->json = Zend_Json::encode($r);
	}

    	public function crearAction()
   	{
   		$this->contenidoPagina("Crear Nuevo Producto Tintoreria");
       	 	$form = $this->getFormCrear();
      	  	echo $form;   
   	}
	/*
	*Creo un nuevo prod
	*/
    	public function guardarAction()
    	{
    		$this->_forward('index');
    		$form = $this->getFormCrear();
        	if ($form->isValid($_POST)) { //*** Valido que todos los parametros required esten
			  $lav = new Application_Model_productostintoreria;
			  $values = $form->getValues(); //*** obtengo los valores
			  $lav->CrearOrden($values["nombre"],$values["descripcion"],$values["precio"]);//*** guardo los registros
			  $this->view->mensaje = "\"Producto ".$values["nombre"]." creado con exito\"";
			  
		}else 
			$this->view->mensaje = "\"A Ocurrido un error; El formulario no tiene todos los campos llenos\"";
    	}
	/*
	*Borro un registro
	*/
    	public function eliminarAction()
    	{
    		$this->_forward('index');
    		$form = $this->getFormId();
        	if ($form->isValid($_GET)) { //*** Valido que todos los parametros required esten
			  $lav = new Application_Model_productostintoreria;
			  $values = $form->getValues(); //*** obtengo los valores
			  $lav->deleteContact($values["id"]);//*** guardo los registros
			  $this->view->mensaje = "\"Producto ".$values["nombre"]." eliminado con exito\"";
			  
		}else 
			$this->view->mensaje = "\"A Ocurrido un error; El formulario no tiene todos los campos llenos\"";
    	}

}

